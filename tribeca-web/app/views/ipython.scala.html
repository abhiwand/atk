@(message: String, user: models.database.UserRow)

@mainLoggedIn(message, user) {

    <div id='main-content'>

        <div id='main-content-upload'>
            <div class='container'>
                <div class="row" >
                    <div class='col-sm-12'>
                      
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="unit-tests">unit tests</h2>
<p>This is an example of unit testing with nose. We are trying to make sure that the function calc_gc properly calculated the gc fraction of the DNA sequence.</p>
<p>Problems worked through in class included --</p>
<ol style="list-style-type: decimal">
<li>the sequence contained 'N's</li>
<li>the sequence contained lowercase char</li>
<li>divide by zero for sequences with no A, T, C, G</li>
</ol>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[1]:
</div>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="o">%%</span><span class="k">file</span> <span class="n">calc_gc</span><span class="o">.</span><span class="n">py</span>
<span class="k">def</span> <span class="nf">calc_gc</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>                    <span class="c"># make all chars uppercase</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)</span>  <span class="c"># count only A, T,</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;G&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">)</span>  <span class="c"># C, and G -- nothing else (no Ns, Rs, Ws, etc.)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span>                                  <span class="c"># avoid divide-by-zero</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_1</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">calc_gc</span><span class="p">(</span><span class="s">&#39;ATGGCAT&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;hello, this is a test; the value of result is&#39;</span><span class="p">,</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mf">0.43</span>
    
<span class="k">def</span> <span class="nf">test_2</span><span class="p">():</span> <span class="c"># test handling N</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">calc_gc</span><span class="p">(</span><span class="s">&#39;NATGC&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">result</span>
    
<span class="k">def</span> <span class="nf">test_3</span><span class="p">():</span> <span class="c"># test handling lowercase</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">calc_gc</span><span class="p">(</span><span class="s">&#39;natgc&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">result</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt"></div>
<div class="box-flex1 output_subarea output_stream output_stdout">
<pre>
Overwriting calc_gc.py

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="running-nosetests">Running nosetests</h2>
<p>Here, the 'nosetests' command looks through calc_gc.py, finds all functions named test_, and runs them.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[2]:
</div>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="o">!</span>nosetests calc_gc.py
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt"></div>
<div class="box-flex1 output_subarea output_stream output_stdout">
<pre>
...
----------------------------------------------------------------------
Ran 3 tests in 0.001s

OK

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also run nosetests with a '-v' option:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[3]:
</div>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="o">!</span>nosetests -v calc_gc.py
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt"></div>
<div class="box-flex1 output_subarea output_stream output_stdout">
<pre>
calc_gc.test_1 ... ok
calc_gc.test_2 ... ok
calc_gc.test_3 ... ok

----------------------------------------------------------------------
Ran 3 tests in 0.001s

OK

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="regression-testing">Regression testing</h2>
<p>Here I'm going to set up some regression tests, where we're simply comparing the output of a previously run script with the output of that script now. If we're running on the same data, we should get the same answer... right?</p>
<p>The script just calculates the average of the average GC content of each sequence in 25k.fq.gz.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[4]:
</div>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="o">%%</span><span class="k">file</span> <span class="n">gc</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">seqs</span><span class="o">.</span><span class="n">py</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">screed</span>
<span class="kn">import</span> <span class="nn">calc_gc</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>    <span class="c"># take the sequence filename in from the command line</span>
<span class="n">total_gc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">screed</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">gc</span> <span class="o">=</span> <span class="n">calc_gc</span><span class="o">.</span><span class="n">calc_gc</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">total_gc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
    
<span class="k">print</span> <span class="nb">sum</span><span class="p">(</span><span class="n">total_gc</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">total_gc</span><span class="p">))</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt"></div>
<div class="box-flex1 output_subarea output_stream output_stdout">
<pre>
Overwriting gc-of-seqs.py

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[5]:
</div>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="c"># run the script and look at the output -- then write that output into the following file.</span>
<span class="o">!</span>python gc-of-seqs.py 25k.fq.gz
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt"></div>
<div class="box-flex1 output_subarea output_stream output_stdout">
<pre>
0.607911191366

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[6]:
</div>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="o">%%</span><span class="k">file</span> <span class="n">test_gc_script</span><span class="o">.</span><span class="n">py</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">correct_output</span> <span class="o">=</span> <span class="s">&quot;0.607911191366</span><span class="se">\n</span><span class="s">&quot;</span>   <span class="c"># this is taken from the previous exec&#39;d cell</span>

<span class="c"># the following function checks to see if running this script at the command line</span>
<span class="c"># returns the right result.  make sure you&#39;re running this from *within* the python/ subdirectory</span>
<span class="c"># of the 2012-11-scripps/ repository.</span>
<span class="k">def</span> <span class="nf">test_run</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s">&#39;python gc-of-seqs.py 25k.fq.gz&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">stdout</span> <span class="o">==</span> <span class="n">correct_output</span>
    
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt"></div>
<div class="box-flex1 output_subarea output_stream output_stdout">
<pre>
Overwriting test_gc_script.py

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[7]:
</div>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="o">!</span>nosetests test_gc_script.py
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt"></div>
<div class="box-flex1 output_subarea output_stream output_stdout">
<pre>
.
----------------------------------------------------------------------
Ran 1 test in 0.937s

OK

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[7]:
</div>
<div class="input_area box-flex1">
<div class="highlight"><pre>
</pre></div>

</div>
</div>

</div>
                        <div class="row-fluid">
                         
                        </div>
                        <a href ='#'>
                            <button type="button" class="btn btn-primary btn-lg btn-block">That was awesome. Export it!</button>
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class='fade' id='scroll-to-top'>
        <i class='fa-icon-chevron-up'></i>
    </div>
}