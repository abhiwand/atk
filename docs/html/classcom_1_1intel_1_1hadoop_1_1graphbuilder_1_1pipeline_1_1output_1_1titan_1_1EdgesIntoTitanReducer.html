<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>GraphBuilder 2.0 (alpha): com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GraphBuilder 2.0 (alpha)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li class="current"><a href="annotated.html"><span>Javadoc</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacecom.html">com</a></li><li class="navelem"><a class="el" href="namespacecom_1_1intel.html">intel</a></li><li class="navelem"><a class="el" href="namespacecom_1_1intel_1_1hadoop.html">hadoop</a></li><li class="navelem"><a class="el" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder.html">graphbuilder</a></li><li class="navelem"><a class="el" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline.html">pipeline</a></li><li class="navelem"><a class="el" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output.html">output</a></li><li class="navelem"><a class="el" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan.html">titan</a></li><li class="navelem"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1EdgesIntoTitanReducer.html">EdgesIntoTitanReducer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1EdgesIntoTitanReducer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1EdgesIntoTitanReducer.png" usemap="#com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer_map" alt=""/>
  <map id="com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer_map" name="com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer_map">
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2eca871cee8c1ab2a4e03ecd01529bad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1EdgesIntoTitanReducer.html#a2eca871cee8c1ab2a4e03ecd01529bad">setup</a> (Context context)  throws IOException, InterruptedException </td></tr>
<tr class="separator:a2eca871cee8c1ab2a4e03ecd01529bad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a356fbc017f561ccb1ba7992cff359de0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1EdgesIntoTitanReducer.html#a356fbc017f561ccb1ba7992cff359de0">reduce</a> (IntWritable key, Iterable&lt; SerializedGraphElement &gt; values, Context context)  throws IOException, InterruptedException </td></tr>
<tr class="separator:a356fbc017f561ccb1ba7992cff359de0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ff50303d32aa87abcc009c5e2af85f6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1EdgesIntoTitanReducer.html#a1ff50303d32aa87abcc009c5e2af85f6">cleanup</a> (Context context)  throws IOException, InterruptedException </td></tr>
<tr class="separator:a1ff50303d32aa87abcc009c5e2af85f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7ab43707448f98465f1ad7e506ec7c5"><td class="memItemLeft" align="right" valign="top">Enum&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1EdgesIntoTitanReducer.html#ab7ab43707448f98465f1ad7e506ec7c5">getEdgeCounter</a> ()</td></tr>
<tr class="separator:ab7ab43707448f98465f1ad7e506ec7c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afea9823f8a12a81a9a400747bfa7078a"><td class="memItemLeft" align="right" valign="top">Enum&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1EdgesIntoTitanReducer.html#afea9823f8a12a81a9a400747bfa7078a">getEdgePropertiesCounter</a> ()</td></tr>
<tr class="separator:afea9823f8a12a81a9a400747bfa7078a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Loads edges into Titan. </p>
<p>This class gathers each vertex with the edges that point to that vertex, that is, those edges for which the vertex is the destination. Because the edges were tagged with the Titan IDs of their sources in the previous Map Reduce job and each vertex is tagged with its Titan ID, we now know the Titan ID of the source and destination of the edges and can add them to Titan. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a1ff50303d32aa87abcc009c5e2af85f6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer.cleanup </td>
          <td>(</td>
          <td class="paramtype">Context&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td> throws IOException, InterruptedException</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Performs cleanup tasks after the reducer finishes.</p>
<p>In particular, closes the Titan graph. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">@code</td><td>context  Hadoop provided reducer context. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">IOException</td><td></td></tr>
    <tr><td class="paramname">InterruptedException</td><td></td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                                                                  {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        this.graph.shutdown();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab7ab43707448f98465f1ad7e506ec7c5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Enum com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer.getEdgeCounter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                 {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">return</span> Counters.NUM_EDGES;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afea9823f8a12a81a9a400747bfa7078a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Enum com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer.getEdgePropertiesCounter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                          {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">return</span> Counters.EDGE_PROPERTIES_WRITTEN;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a356fbc017f561ccb1ba7992cff359de0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer.reduce </td>
          <td>(</td>
          <td class="paramtype">IntWritable&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Iterable&lt; SerializedGraphElement &gt;&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Context&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> throws IOException, InterruptedException</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Hadoop-called routine for loading edges into Titan. </p>
<p>We assume that the edges and vertices have been gathered so that every edge shares the reducer of its destination vertex, and that every edge has previously been assigned the Titan ID of its source vertex. </p>
<p>Titan IDs are propagated from the destination vertices to each edge and the edges are loaded into Titan using the BluePrints API. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">@code</td><td>key  A map reduce key; a hash of a vertex ID. </td></tr>
    <tr><td class="paramname">@code</td><td>values  Either a vertex with that hashed vertex ID, or an edge with said vertex as its destination. </td></tr>
    <tr><td class="paramname">@code</td><td>context  A reducer context provided by Hadoop. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">IOException</td><td></td></tr>
    <tr><td class="paramname">InterruptedException</td><td></td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                                     {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        Hashtable&lt;EdgeID, Writable&gt; edgePropertyTable  = <span class="keyword">new</span> Hashtable();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">for</span>(SerializedGraphElement graphElement: values){</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">             * This is calling EdgesIntoTitanReducerCallback which is an implementation</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">             * of GraphElementTypeCallback to add all the edges and vertices into</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">             * the edgePropertyTable and vertexNameToTitanID hashmaps.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            graphElement.graphElement().typeCallback(edgesIntoTitanReducerCallback,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    ArgumentBuilder.newArguments().with(<span class="stringliteral">&quot;edgePropertyTable&quot;</span>, edgePropertyTable)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                            .with(<span class="stringliteral">&quot;vertexNameToTitanID&quot;</span>, vertexNameToTitanID));</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordtype">int</span> edgeCount   = 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment">// Output edge records</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">for</span> (Map.Entry&lt;EdgeID, Writable&gt; edgeMapEntry : edgePropertyTable.entrySet()) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            Object dst   = edgeMapEntry.getKey().getDst();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            String label = edgeMapEntry.getKey().getLabel().toString();</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            PropertyMap propertyMap = (PropertyMap) edgeMapEntry.getValue();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="keywordtype">long</span> srcTitanId = ((LongType) propertyMap.getProperty(<span class="stringliteral">&quot;srcTitanID&quot;</span>)).<span class="keyword">get</span>();</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordtype">long</span> dstTitanId = vertexNameToTitanID.get(dst);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            com.tinkerpop.blueprints.Vertex srcBlueprintsVertex = this.graph.getVertex(srcTitanId);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            com.tinkerpop.blueprints.Vertex tgtBlueprintsVertex = this.graph.getVertex(dstTitanId);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="comment">// Major operation - add the edge to Titan graph</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            com.tinkerpop.blueprints.Edge bluePrintsEdge = null;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                bluePrintsEdge = this.graph.addEdge(null,srcBlueprintsVertex, tgtBlueprintsVertex, label);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            } <span class="keywordflow">catch</span> (IllegalArgumentException e) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                GraphBuilderExit.graphbuilderFatalExitException(<a class="code" href="enumcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1util_1_1StatusCode.html#a1c44238e51d562f1ee1c30941279e0a6">StatusCode.TITAN_ERROR</a>,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        <span class="stringliteral">&quot;Could not add edge to Titan; likely a schema error. The label on the edge is  &quot;</span> + label,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                        LOG, e);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="comment">// The edge is added to the graph; now add the edge properties.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="comment">// The &quot;srcTitanID&quot; property was added during this MR job to propagate the </span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="comment">// Titan ID of the edge&#39;s source vertex to this reducer ... we can remove it now.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            propertyMap.removeProperty(<span class="stringliteral">&quot;srcTitanID&quot;</span>);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <span class="keywordflow">for</span> (Writable propertyKey : propertyMap.getPropertyKeys()) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                EncapsulatedObject mapEntry = (EncapsulatedObject) propertyMap.getProperty(propertyKey.toString());</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    bluePrintsEdge.setProperty(propertyKey.toString(), mapEntry.getBaseObject());</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                } <span class="keywordflow">catch</span> (IllegalArgumentException e) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    LOG.fatal(<span class="stringliteral">&quot;GRAPHBUILDER_ERROR: Could not add edge property; probably a schema error. The label on the edge is  &quot;</span> + label);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                    LOG.fatal(<span class="stringliteral">&quot;GRAPHBUILDER_ERROR: The property on the edge is &quot;</span> + propertyKey.toString());</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                    LOG.fatal(e.getMessage());</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    GraphBuilderExit.graphbuilderFatalExitException(<a class="code" href="enumcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1util_1_1StatusCode.html#a04481688bf7982e517cfd40f1fa4dd4c">StatusCode.INDESCRIBABLE_FAILURE</a>, <span class="stringliteral">&quot;&quot;</span>, LOG, e);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            edgeCount++;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">if</span> (edgeCount &gt; 0 &amp;&amp; edgeCount % BULK_EDGE_COMMIT_SIZE == 0) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    this.graph.commit();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    LOG.info(<span class="stringliteral">&quot;Successfully committed &quot;</span> + BULK_EDGE_COMMIT_SIZE</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                            + <span class="stringliteral">&quot; edges to Titan&quot;</span>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                } <span class="keywordflow">catch</span> (Throwable e) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                    LOG.info(<span class="stringliteral">&quot;Commit failed for edge count: &quot;</span> + edgeCount);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        context.getCounter(Counters.NUM_EDGES).increment(edgeCount);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div>
<div class="ttc" id="enumcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1util_1_1StatusCode_html_a04481688bf7982e517cfd40f1fa4dd4c"><div class="ttname"><a href="enumcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1util_1_1StatusCode.html#a04481688bf7982e517cfd40f1fa4dd4c">com.intel.hadoop.graphbuilder.util.StatusCode.INDESCRIBABLE_FAILURE</a></div><div class="ttdeci">INDESCRIBABLE_FAILURE</div><div class="ttdef"><b>Definition:</b> StatusCode.java:32</div></div>
<div class="ttc" id="enumcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1util_1_1StatusCode_html_a1c44238e51d562f1ee1c30941279e0a6"><div class="ttname"><a href="enumcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1util_1_1StatusCode.html#a1c44238e51d562f1ee1c30941279e0a6">com.intel.hadoop.graphbuilder.util.StatusCode.TITAN_ERROR</a></div><div class="ttdeci">TITAN_ERROR</div><div class="ttdef"><b>Definition:</b> StatusCode.java:34</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2eca871cee8c1ab2a4e03ecd01529bad"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void com.intel.hadoop.graphbuilder.pipeline.output.titan.EdgesIntoTitanReducer.setup </td>
          <td>(</td>
          <td class="paramtype">Context&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td> throws IOException, InterruptedException</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets up the Titan connection.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">@code</td><td>context  The reducer context provided by Hadoop. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">IOException</td><td></td></tr>
    <tr><td class="paramname">InterruptedException</td><td></td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                                                                                {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        this.vertexNameToTitanID = <span class="keyword">new</span> Hashtable&lt;Object, Long&gt;();</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        this.graph               = getTitanGraphInstance(context);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        edgesIntoTitanReducerCallback = <span class="keyword">new</span> EdgesIntoTitanReducerCallback();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/main/java/com/intel/hadoop/graphbuilder/pipeline/output/titan/<a class="el" href="EdgesIntoTitanReducer_8java.html">EdgesIntoTitanReducer.java</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 20 2013 18:43:59 for GraphBuilder 2.0 (alpha) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
